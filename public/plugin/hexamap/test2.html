

<!-- Plugin Map -->
<link rel="stylesheet" href="./stuquery.hexmap.css">
<link rel="stylesheet" href="./perso.hexmap.css">
<script type="text/javascript" src="./stuquery.min.js"></script>
<script type="text/javascript" src="./stuquery.hexmap.js"></script>


<!-- Plugin Zoom -->
<script src='../panzoom/dist/panzoom.js' ></script>


<section class="area-map" id="area-map">
    <div id="hexmap" class="hexmap" data-zoom="1">
        <code>
        {
            "layout":"odd-r",
            "hexes": {
                "0":{"q":0,     "r":0,    "name":"0-0",    "type":"mountains",      "state":1       },
                "1":{"q":1,     "r":0,    "name":"1-0",    "type":"desert",         "state":1       },
                "2":{"q":2,     "r":0,    "name":"2-0",    "type":"fields",         "state":2       },
                "3":{"q":0,     "r":1,    "name":"0-1",    "type":"forest",         "state":2       },
                "4":{"q":1,     "r":1,    "name":"1-1",    "type":"mountains",      "state":2       },
                "5":{"q":2,     "r":1,    "name":"2-1",    "type":"mountains",      "state":2       },
                "6":{"q":0,     "r":2,    "name":"0-2",    "type":"mountains",      "state":1       },
                "7":{"q":1,     "r":2,    "name":"1-2",    "type":"mountains",      "state":1       },
                "8":{"q":2,     "r":2,    "name":"2-2",    "type":"mountains",      "state":2       },
                "9":{"q":10,     "r":10,    "name":"2-2",    "type":"mountains",      "state":2       },
                "100":{"q":10,     "r":10,    "name":"2-2",    "type":"mountains",      "state":1       },
                "101":{"q":100,     "r":30,    "name":"2-2",    "type":"mountains",      "state":1       },
                "102":{"q":-5,     "r":-5,    "name":"2-2",    "type":"mountains",      "state":1       }

            }
        }
        </code>


    </div>
</section>
  <div class='button-container'>
    <a href="#" class='button' data-hex="2">Center</a>
    <a href="#" class='button' data-hex="1">Region 1</a>
  </div>

<div id="message-8">Click or hover on a hex</div>

<script>

S(document).ready(function(){
	var hexmap = S.hexmap('hexmap');
	hexmap.positionHexes();//.resize();

	hexmap.setContent(function(id,hex){
		// Build the circular token that sits on a hex
		str = '<div class="token'+((hex.dice==8 || hex.dice == 6) ? ' token-red':'')+'">';
            str += '<div class="id">'+' '+hex.q+','+hex.r+'</div>'; //coor
            str += '<div class="dice">'+hex.name+'</div>'; //nom
            str += '<div class="odds">'+id+ '</div>'; 
		str += '</div>';

		return str;
	});
	
	// Set the CSS class of each hex to be the hex type
	hexmap.setClass(function(id,hex){
		return hex.type;
	});
    
    hexmap.setBorder(function(id,hex){
		return hex.type;
	});

    
    //Event
    hexmap.on('click',function(e){
        console.log(e.hex.id);
	}).on('mouseover',function(e){
		S('#message-8').html('You have hovered over hex '+e.i+' ('+e.hex.id+')');
	}).on('mouseout',function(e){
		S('#message-8').html('You have left hex '+e.i+' ('+e.hex.id+')');
	}).on('focus',function(e){
		S('#message-8').html('You have focussed on hex '+e.i+' ('+e.hex.id+')');
	});
    
    
    
    //Zoom and move
    var x = 0; 
    var y = 0; 
    var region = document.querySelectorAll(".hex[data-id='100']");
    if(region !== 'undefined'){
        x = region[0].offsetLeft - document.getElementById('area-map').clientWidth;
        y = region[0].offsetTop - document.getElementById('area-map').clientHeight;        
    }
    
	var zoom = panzoom(document.getElementById('hexmap'), {
        maxZoom: 4,
        minZoom: 0.2,
    });
    
    zoom.zoomAbs(
          -x, // initial x position
          -y, // initial y position
          0.5 // zoom
    );



    
    //button move
    Array.from(
      document.querySelectorAll('.button-container a.button')
    ).forEach(attachClickHandler)

    function attachClickHandler(el) {
      el.addEventListener('click', handleClick);
    }

    function handleClick(e) {
        var region = document.querySelectorAll(".hex[data-id='"+ this.getAttribute('data-hex') +"']");
        x = region[0].offsetLeft;
        y = region[0].offsetTop;  
        
        console.log(x);
        console.log(y);
        
        console.log(zoom.getTransform());
        zoom.moveTo(x, y);
        zoom.moveBy(x - zoom.getTransform().x , y - zoom.getTransform().y, 1);
    }
    
    
});

</script>